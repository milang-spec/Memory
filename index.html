<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kinder-Memory (DE⇄EN)</title>
<style>
  :root { --tile: 120px; } /* Kartengröße */
  * { box-sizing: border-box; }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    margin: 0; color: #083344;
    background: linear-gradient(#ecfeff, #f0fdf4);
    display: flex; flex-direction: column; align-items: center; padding: 12px;
  }
  header, .panel { width: 100%; max-width: 960px; }
  header {
    display: flex; gap: 8px; align-items: center; justify-content: space-between; flex-wrap: wrap; margin-bottom: 8px;
  }
  h1 { margin: 0; font-size: clamp(20px, 3.5vw, 28px); color:#065f46; }
  .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  button { border: 1px solid #10b981; background: #10b981; color: #fff; padding: 8px 12px; border-radius: 12px; cursor: pointer; }
  button.secondary { border-color: #e5e7eb; background:#fff; color:#111827; }
  #status { margin: 8px 0; font-weight: 600; }

  #game {
    display: grid; gap: 12px; justify-content: center; margin-top: 8px;
    grid-template-columns: repeat(auto-fit, minmax(var(--tile), 1fr));
    width: 100%; max-width: 960px;
  }
  .card {
    width: 100%; max-width: var(--tile); aspect-ratio: 1/1;
    background: repeating-linear-gradient(45deg,#7dd3fc 0 12px,#38bdf8 12px 24px);
    border: 4px solid #000; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 40px; user-select: none; touch-action: manipulation;
    box-shadow: inset 0 2px 8px rgba(0,0,0,.06);
  }
  .card.revealed { background: #ffffff; border-color: #000; flex-direction: column; }
  .emoji { font-size: clamp(42px, 8vw, 64px); line-height: 1; }
  .label { margin-top: 6px; font-size: clamp(12px,2.6vw,15px); color:#111; text-align:center; font-weight: bold; }
  .swatch { width: 66%; aspect-ratio: 1/1; border-radius: 999px; border: 3px solid #000; }

  /* Start-Screen */
  #startScreen {
    background:#fff; border:1px solid #e5e7eb; border-radius:14px;
    box-shadow: 0 6px 20px rgba(0,0,0,.06);
    padding: 16px; margin-top: 10px;
  }
  .row { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
  label { font-size: 14px; color:#334155; display:block; margin-bottom: 4px; }
  input[type="text"], select {
    width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 16px;
  }
  .hint { font-size: 13px; color:#475569; margin-top: 6px; }
</style>
</head>
<body>

<header>
  <h1>🎴 Kinder-Memory (DE ⇄ EN)</h1>
  <div class="controls">
    <button id="newBtn" class="secondary">Neues Spiel</button>
    <button id="backBtn" class="secondary">Zurück</button>
  </div>
</header>

<!-- Start-Screen -->
<section id="startScreen" class="panel">
  <h2 style="margin:0 0 10px;font-size:20px">Spieler & Start</h2>
  <div class="row">
    <div>
      <label for="p1">Name Spieler 1</label>
      <input id="p1" type="text" placeholder="z. B. Anna" />
    </div>
    <div>
      <label for="p2">Name Spieler 2</label>
      <input id="p2" type="text" placeholder="z. B. Ben" />
    </div>
    <div>
      <label for="pairCount">Anzahl Paare</label>
      <select id="pairCount">
        <option value="5">5 Paare</option>
        <option value="6" selected>6 Paare</option>
        <option value="7">7 Paare</option>
        <option value="8">8 Paare</option>
        <option value="9">9 Paare</option>
      </select>
    </div>
  </div>
  <div class="hint">Es werden so viele Paare zufällig aus dem Motiv-Pool gewählt.</div>
  <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
    <button id="startBtn">Spiel starten</button>
  </div>
</section>

<div id="status"></div>
<div id="game" aria-live="polite"></div>

<script>
const POOL = [
  { de: "Fee",        en: "fairy",    type: "emoji", emoji: "🧚" },
  { de: "Einhorn",    en: "unicorn",  type: "emoji", emoji: "🦄" },
  { de: "Prinzessin", en: "princess", type: "emoji", emoji: "👸" },
  { de: "Lila",       en: "purple",   type: "color", color: "#7c3aed" },
  { de: "Rosa",       en: "rose",     type: "color", color: "#f9a8d4" },
  { de: "Pink",       en: "pink",     type: "color", color: "#ec4899" },
  { de: "Pferd",      en: "horse",    type: "emoji", emoji: "🐴" },
  { de: "Hase",       en: "rabbit",   type: "emoji", emoji: "🐰" },
  { de: "Löwe",       en: "lion",     type: "emoji", emoji: "🦁" }
];

let pairCount = 6;
let started = false, deck = [], revealed = [], matched  = [], currentPlayer = 0, scores = [0,0], players = ["Spieler 1","Spieler 2"], lock = false;

function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
function samplePairs(pool, n) { const a = pool.slice(); shuffle(a); return a.slice(0, n); }

function speakEnglish(text) {
  if (!text || !('speechSynthesis' in window)) return;
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US"; msg.rate = 0.9;
  try { speechSynthesis.cancel(); } catch(e) {}
  speechSynthesis.speak(msg);
}

function buildDeck() {
  const chosen = samplePairs(POOL, pairCount);
  deck = [];
  chosen.forEach((w, idx) => {
    deck.push({ ...w, id: w.de + "-a-" + idx });
    deck.push({ ...w, id: w.de + "-b-" + idx });
  });
  shuffle(deck);
}

function toGame() { document.getElementById("startScreen").style.display = "none"; started = true; }
function toStartScreen() { started = false; document.getElementById("startScreen").style.display = "block"; document.getElementById("status").textContent = "Namen & Paare wählen."; document.getElementById("game").innerHTML = ""; }

function startGame() {
  const p1Name = document.getElementById("p1").value.trim() || "Spieler 1";
  const p2Name = document.getElementById("p2").value.trim() || "Spieler 2";
  pairCount = parseInt(document.getElementById("pairCount").value, 10) || 6;
  players = [p1Name, p2Name];
  newRound();
  toGame();
}

function newRound() {
  scores = [0,0]; currentPlayer = 0; matched = []; revealed = [];
  buildDeck(); renderBoard(); updateStatus();
}

function renderBoard() {
  const game = document.getElementById("game");
  game.innerHTML = "";
  deck.forEach(card => {
    const div = document.createElement("button");
    div.className = "card";
    div.setAttribute("aria-label", `Karte ${card.de} / ${card.en}`);
    div.onclick = () => handleClick(card);
    const isOpen = revealed.includes(card.id) || matched.includes(card.id);
    if (isOpen) {
      div.classList.add("revealed");
      if (card.type === "emoji") {
        const emo = document.createElement("div"); emo.className = "emoji"; emo.textContent = card.emoji; div.appendChild(emo);
      } else {
        const sw = document.createElement("div"); sw.className = "swatch"; sw.style.background = card.color; div.appendChild(sw);
      }
      const label = document.createElement("div"); label.className = "label"; label.innerHTML = `<b>${card.de}</b> · <i>${card.en}</i>`; div.appendChild(label);
    } else { div.textContent = "🎴"; }
    game.appendChild(div);
  });
}

function handleClick(card) {
  if (!started) return;
  if (revealed.includes(card.id) || matched.includes(card.id)) { speakEnglish(card.en); return; }
  if (lock) return;
  if (revealed.length === 0) {
    revealed.push(card.id); speakEnglish(card.en); renderBoard(); return;
  }
  if (revealed.length === 1) {
    lock = true;
    setTimeout(() => {
      revealed.push(card.id); speakEnglish(card.en); renderBoard();
      setTimeout(() => {
        const [id1, id2] = revealed;
        const c1 = deck.find(c => c.id === id1); const c2 = deck.find(c => c.id === id2);
        const isMatch = c1 && c2 && c1.en === c2.en && id1 !== id2;
        if (isMatch) { matched.push(id1, id2); scores[currentPlayer] += 1; revealed = []; }
        else { revealed = []; currentPlayer = currentPlayer === 0 ? 1 : 0; }
        lock = false; renderBoard(); updateStatus();
        if (matched.length === deck.length) { document.getElementById("status").textContent = `Fertig! ${scores[0] === scores[1] ? "Unentschieden" : (scores[0] > scores[1] ? players[0] : players[1]) + " gewinnt!"}`; }
      }, 900);
    }, 300);
  }
}

function updateStatus() { document.getElementById("status").textContent = `${players[currentPlayer]} ist dran · ${players[0]}: ${scores[0]} | ${players[1]}: ${scores[1]}`; }

document.getElementById("startBtn").addEventListener("click", startGame);
document.getElementById("newBtn").addEventListener("click", () => { if (!started) { startGame(); } else { newRound(); } });
document.getElementById("backBtn").addEventListener("click", () => toStartScreen());

document.getElementById("status").textContent = "Namen & Paare wählen.";
</script>

</body>
</html>
