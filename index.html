<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kinder-Memory (DEâ‡„EN)</title>
<style>
  :root { --tile: 110px; }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    margin: 0; color: #083344;
    background: linear-gradient(#ecfeff, #f0fdf4);
    display: flex; flex-direction: column; align-items: center; padding: 12px;
  }
  header {
    width: 100%; max-width: 960px; display: flex; gap: 8px;
    align-items: center; justify-content: space-between; flex-wrap: wrap; margin-bottom: 8px;
  }
  h1 { margin: 0; font-size: clamp(20px, 3.5vw, 28px); color:#065f46; }
  .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  input { padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 10px; min-width: 140px; }
  button { border: 1px solid #10b981; background: #10b981; color: #fff; padding: 8px 12px; border-radius: 12px; cursor: pointer; }
  button.secondary { border-color: #e5e7eb; background:#fff; color:#111827; }
  #status { margin: 8px 0; font-weight: 600; }
  #game {
    display: grid; gap: 12px; justify-content: center; margin-top: 8px;
    grid-template-columns: repeat(auto-fit, minmax(var(--tile), 1fr));
    width: 100%; max-width: 960px;
  }
  .card {
    width: 100%; max-width: var(--tile); aspect-ratio: 1/1;
    background: repeating-linear-gradient(45deg,#a7f3d0 0 12px,#99f6e4 12px 24px);
    border: 1px solid #34d399; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 40px; user-select: none; touch-action: manipulation;
    box-shadow: inset 0 2px 8px rgba(0,0,0,.06);
  }
  .card.revealed {
    background: #ffffff; border-color: #a7f3d0; flex-direction: column;
  }
  .emoji { font-size: clamp(42px, 8vw, 64px); line-height: 1; }
  .label { margin-top: 6px; font-size: clamp(12px,2.6vw,15px); color:#374151; text-align:center; }
  /* Farbkreise */
  .swatch {
    width: 66%; aspect-ratio: 1/1; border-radius: 999px; border: 2px solid #e5e7eb;
  }
</style>
</head>
<body>

<header>
  <h1>ðŸŽ´ Kinder-Memory (DE â‡„ EN)</h1>
  <div class="controls">
    <input id="p1" placeholder="Spieler 1" />
    <input id="p2" placeholder="Spieler 2" />
    <button id="startBtn">Spiel starten</button>
    <button id="newBtn" class="secondary" title="Neue Runde mit frischem Mix">Neues Spiel</button>
  </div>
</header>

<div id="status"></div>
<div id="game"></div>

<script>
/* ===== Fixe 6 Paare (nur diese Symbole) ===== */
const WORDS = [
  { de: "Fee",        en: "fairy",    type: "emoji", emoji: "ðŸ§š" },
  { de: "Einhorn",    en: "unicorn",  type: "emoji", emoji: "ðŸ¦„" },
  { de: "Prinzessin", en: "princess", type: "emoji", emoji: "ðŸ‘¸" },
  { de: "Lila",       en: "purple",   type: "color", color: "#7c3aed" }, // violet
  { de: "Rosa",       en: "rose",     type: "color", color: "#f9a8d4" }, // light pink
  { de: "Pink",       en: "pink",     type: "color", color: "#ec4899" }  // hot pink
];

document.documentElement.style.setProperty('--tile', '110px');

let deck = [];
let revealed = [];   // aktuell offene Karten-IDs (max 2)
let matched  = [];   // dauerhaft gefundene Karten-IDs
let currentPlayer = 0;
let scores = [0,0];
let players = ["Spieler 1","Spieler 2"];
let lock = false;

/* ===== Utilities ===== */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* ===== Sprachausgabe (Englisch) ===== */
function speakEnglish(text) {
  if (!text || !('speechSynthesis' in window)) return;
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US";
  msg.rate = 0.9;
  try { speechSynthesis.cancel(); } catch(e) {}
  speechSynthesis.speak(msg);
}

/* ===== Setup ===== */
function buildDeck() {
  deck = [];
  const pairs = WORDS.slice(0, 6); // genau 6 Paare
  pairs.forEach((w, idx) => {
    deck.push({ ...w, id: w.de + "-a-" + idx });
    deck.push({ ...w, id: w.de + "-b-" + idx });
  });
  shuffle(deck);
}

function startGame() {
  const p1Name = document.getElementById("p1").value.trim() || "Spieler 1";
  const p2Name = document.getElementById("p2").value.trim() || "Spieler 2";
  players = [p1Name, p2Name];
  newRound();
}

function newRound() {
  scores = [0,0];
  currentPlayer = 0;
  matched = [];
  revealed = [];
  buildDeck();
  renderBoard();
  updateStatus();
}

/* ===== Render ===== */
function renderBoard() {
  const game = document.getElementById("game");
  game.innerHTML = "";
  deck.forEach(card => {
    const div = document.createElement("button");
    div.className = "card";
    div.setAttribute("aria-label", `Karte ${card.de} / ${card.en}`);
    div.onclick = () => handleClick(card);

    const isOpen = revealed.includes(card.id) || matched.includes(card.id);
    if (isOpen) {
      div.classList.add("revealed");
      // Inhalt
      if (card.type === "emoji") {
        const emo = document.createElement("div");
        emo.className = "emoji";
        emo.textContent = card.emoji;
        div.appendChild(emo);
      } else {
        const sw = document.createElement("div");
        sw.className = "swatch";
        sw.style.background = card.color;
        sw.setAttribute("role", "img");
        sw.setAttribute("aria-label", card.en);
        div.appendChild(sw);
      }
      const label = document.createElement("div");
      label.className = "label";
      label.innerHTML = `<b>${card.de}</b> Â· <i>${card.en}</i>`;
      div.appendChild(label);
    } else {
      div.textContent = "ðŸŽ´";
    }
    game.appendChild(div);
  });
}

/* ===== Logik ===== */
function handleClick(card) {
  // Wiederholen: auf bereits offene ODER schon gefundene Karte tippen
  if (revealed.includes(card.id) || matched.includes(card.id)) {
    speakEnglish(card.en);
    return;
  }
  if (lock) return;

  // 1. Klick: sofort aufdecken
  if (revealed.length === 0) {
    revealed.push(card.id);
    speakEnglish(card.en);
    renderBoard();
    return;
  }

  // 2. Klick: **langsamere Umdrehung** â€“ kleine VerzÃ¶gerung vor dem Aufdecken
  if (revealed.length === 1) {
    lock = true;
    setTimeout(() => {
      revealed.push(card.id);
      speakEnglish(card.en);
      renderBoard();

      // Match-Check etwas lÃ¤nger sichtbar lassen
      setTimeout(() => {
        const [id1, id2] = revealed;
        const c1 = deck.find(c => c.id === id1);
        const c2 = deck.find(c => c.id === id2);
        const isMatch = c1 && c2 && c1.en === c2.en && id1 !== id2;

        if (isMatch) {
          matched.push(id1, id2);
          scores[currentPlayer] += 1;
          revealed = []; // gleicher Spieler bleibt dran
        } else {
          revealed = [];
          currentPlayer = currentPlayer === 0 ? 1 : 0;
        }
        lock = false;
        renderBoard();
        updateStatus();

        // Gewinn?
        if (matched.length === deck.length) {
          const status = document.getElementById("status");
          status.textContent =
            `Fertig! ${scores[0] === scores[1] ? "Unentschieden" :
              (scores[0] > scores[1] ? players[0] : players[1]) + " gewinnt!"}`;
        }
      }, 900); // Sichtzeit nach der 2. Umdrehung
    }, 300);   // **VerzÃ¶gerung** beim Umdrehen der 2. Karte
  }
}

function updateStatus() {
  const status = document.getElementById("status");
  status.textContent = `${players[currentPlayer]} ist dran Â· ${players[0]}: ${scores[0]} | ${players[1]}: ${scores[1]}`;
}

/* ===== Events ===== */
document.getElementById("startBtn").addEventListener("click", startGame);
document.getElementById("newBtn").addEventListener("click", () => newRound());

/* Beim Laden */
buildDeck();
renderBoard();
document.getElementById("status").textContent = "Namen eingeben und â€žSpiel startenâ€œ tippen. Oder direkt â€žNeues Spielâ€œ.";
</script>

</body>
</html>
